{"version":3,"sources":["webpack://novablocks/webpack/bootstrap","webpack://novablocks/./node_modules/@babel/runtime/helpers/defineProperty.js","webpack://novablocks/./node_modules/@babel/runtime/helpers/interopRequireDefault.js","webpack://novablocks/./node_modules/classnames/index.js","webpack://novablocks/@novablocks/collection/src/frontend.js","webpack://novablocks/@novablocks/collection/src/layout-engine.js","webpack://novablocks/@novablocks/collection/src/utils.js","webpack://novablocks/external {\"this\":[\"novablocks\",\"utils\"]}"],"names":["$","window","undefined","defaultBlockWidth","each","i","grid","$grid","$block","closest","$cards","$posts","children","attributes","data","cardsCount","length","addedCards","style","setProperty","imagepadding","thumbnailaspectratio","imageresizing","layoutstyle","removeClass","addClass","islandscape","columns","$title","find","detach","$subtitle","onResize","recreateLayout","createLayout","on","blockWidth","outerWidth","empty","remove","areaColumns","columnsCount","firstSet","Math","floor","secondSet","removeSmallestColumn","normalizeColumns","gridcolumns","flipcolsrows","gridrows","maxcolumns","reduce","acc","column","max","col","width","maxrows","row","height","min","compiledAttributes","Object","assign","css","headerposition","clone","insertBefore","areaColumn","areas","$column","attr","j","area","blockWidthRatio","areaClassName","getAreaClassname","postsCount","$area","Array","from","keys","map","$gridItem","$card","eq","landscape","toggleClass","appendTo","$header","contents","replaceWith","display","gridTemplateColumns","gridTemplateRowss","widthRatioMultiplier","index","sort","obj1","obj2","indexToRemove","nth","splice","moveColumnsToLeft","growColumnsToRight","moveColumnsToTop","forEach","spaceLeft","movingLeft","overlapLeft","filter","compareColumn","some","spaceRight","growingRight","overlapRight","spaceTop","movingTop","overlapTop","jQuery","applyLayoutEngine","state","debug","console","log","emptyChar","nthMatrix","initBidimensionalMatrix","imageWeightMatrix","metaDetailsMatrix","widthMatrix","initUnidimensionalMatrix","verticalFragmentSizeMatrix","widthIdx","featureposition","featuresize","frgIdx","cutMarker","fragmentation","padEnd","end","imageweightleft","imageweightright","round","slice","metadetailsleft","metadetailsright","balancemdandiw","abs","boostfeature","maxMetaDetailsPos","maxImageWeightPos","featureValue","maxValue","maxMetaDetailsValue","maxImageWeightValue","subfeature","currentNth","currentColumnStartCol","currentPostStartRow","join","maxNth","hierachyCrossingStrenth","hierarchycrossing","currentPostDetails","getNthPostDetails","endGridColumn","topNeighborPostDetails","startGridRow","bottomNeighborPostDetails","endGridRow","replacedPostScore","imageWeight","metaDetails","counter","postDetails","currentPostScore","pow","startGridColumn","renumberNthMatrix","finalNthMatrix","finalMetaMatrix","finalImageMatrix","getGroupedPostAreas","moveLargestColumnToStart","firstRowColumns","col1","col2","largestColumnIndex","findIndex","logMatrix","matrix","areasArray","getAreasArray","mergeSimilarAreas","normalizeAreas","initialPostsCount","currentColumn","currentArea","compareArea","merged","push","randomColumn","getNthValues","values","value","indexOf","a","b","replaceNth","nth1","nth2","getMaxNth","mergeAreaNeighbours","getAreaWidth","getAreaHeight","initialWidth","initialHeight","currentAreaIndex","isArray","nextRow","nextCol","nextWidth","nextHeight","nextNth","nextNthStart","searching","mergeable","getFirstOccurence","fillArea","newNth","character","nullChar","getGridStyle","getGridColumnsAndRows","gridTemplateRows","getPostsCount","total","columnTotal","redistributeCardsInAreas","totalSpots","totalPosts","remainingPosts","totalRatio","areaColumnSpotRatio","spotRatio","getCardRatio","extraPosts","areaExtraPosts","getOptimalHeaderPosition","positions","columnIndex","areaIndex","ratio","isLandscape","getParametricLayoutAreaClassName","getAreaBaseClassname","getAreaClassnameByWidthRatio","getAreaClassnameByHeightRatio","getAreaClassnameByAspectRatio","widthRatio","heightRatio","transposeMatrix","source"],"mappings":"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","file":"./build/collection/frontend.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./packages/collection/build/frontend.js\");\n","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nmodule.exports = _interopRequireDefault;","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","import classnames from \"classnames\";\nimport { getCardMediaPaddingTop, debounce, below } from \"@novablocks/utils\";\n\nimport {\n\tapplyLayoutEngine,\n} from './layout-engine';\n\nimport {\n\tgetAreaBaseClassname,\n\tgetAreaClassnameByAspectRatio,\n\tgetAreaClassnameByHeightRatio,\n\tgetAreaClassnameByWidthRatio,\n\tgetGridStyle,\n\tgetGridColumnsAndRows,\n\tredistributeCardsInAreas,\n\tisLandscape,\n} from './utils';\n\n(function($, window, undefined) {\n\n\tconst defaultBlockWidth = 1152; // magic\n\n\t$( '.novablocks-grid' ).each( function( i, grid ) {\n\t\tconst $grid = $( grid );\n\t\tconst $block = $grid.closest( '.novablocks-block' );\n\t\tconst $cards = $grid.closest( '.novablocks-collection__cards' );\n\t\tconst $posts = $grid.children( '.novablocks-card' );\n\t\tconst attributes = $grid.data();\n\t\tconst cardsCount = $posts.length;\n\n\t\tlet addedCards;\n\n\t\tgrid.style.setProperty( '--card-media-padding', attributes.imagepadding );\n\t\tgrid.style.setProperty( '--card-media-padding-top', getCardMediaPaddingTop( attributes.thumbnailaspectratio ) );\n\t\tgrid.style.setProperty( '--card-media-object-fit', attributes.imageresizing === 'cropped' ? 'cover' : 'scale-down' );\n\n\t\tif ( attributes.layoutstyle !== 'parametric' ) {\n\t\t\t$grid.removeClass( 'novablocks-grid' );\n\t\t\t$grid.addClass( 'novablocks-collection__layout' );\n\t\t\t$grid.addClass( `novablocks-grid__area--${ attributes.islandscape ? 'landscape' : 'portrait' }` );\n\t\t\t$grid.addClass( getAreaClassnameByWidthRatio( 1 / attributes.columns ) );\n\n\t\t\t$block.addClass( 'novablocks-block--ready' );\n\t\t\treturn;\n\t\t}\n\n\t\tconst $title = $block.find( '.novablocks-collection__title' ).detach();\n\t\tconst $subtitle = $block.find( '.novablocks-collection__subtitle' ).detach();\n\t\tconst onResize = debounce( recreateLayout, 100 );\n\n\t\tcreateLayout();\n\n\t\t$block.addClass( 'novablocks-block--ready' );\n\t\t$( window ).on( 'resize', onResize );\n\n\t\tfunction createLayout() {\n\n\t\t\tlet blockWidth = $grid.outerWidth();\n\n\t\t\t$posts.detach();\n\t\t\t$grid.empty();\n\n\t\t\t$block.find( '.js-collection-element-clone' ).remove();\n\n\t\t\taddedCards = 0;\n\n\t\t\tlet areaColumns = applyLayoutEngine( attributes );\n\t\t\tlet columnsCount = areaColumns.length;\n\t\t\tlet firstSet = Math.floor( ( columnsCount - 1 ) / 2 );\n\t\t\tlet secondSet = columnsCount - 1 - firstSet;\n\n\t\t\tif ( below( 'lap' ) ) {\n\n\t\t\t\tfor ( let i = 0; i < firstSet; i++ ) {\n\t\t\t\t\tremoveSmallestColumn( areaColumns );\n\t\t\t\t}\n\n\t\t\t\tif ( below( 'tablet' ) ) {\n\n\t\t\t\t\tfor ( let i = 0; i < secondSet; i++ ) {\n\t\t\t\t\t\tremoveSmallestColumn( areaColumns );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnormalizeColumns( areaColumns, attributes );\n\t\t\tredistributeCardsInAreas( areaColumns, cardsCount, attributes );\n\n\t\t\tlet gridcolumns = attributes.flipcolsrows ? attributes.gridrows : attributes.gridcolumns;\n\t\t\tlet gridrows = attributes.flipcolsrows ? attributes.gridcolumns : attributes.gridrows;\n\n\t\t\tlet maxcolumns = areaColumns.reduce( ( acc, column ) => {\n\t\t\t\treturn Math.max( acc, column.col + column.width - 1 );\n\t\t\t}, 0);\n\n\t\t\tlet maxrows = areaColumns.reduce( ( acc, column ) => {\n\t\t\t\treturn Math.max( acc, column.row + column.height - 1 );\n\t\t\t}, 0);\n\n\t\t\tgridcolumns = Math.min( gridcolumns, maxcolumns );\n\t\t\tgridrows = Math.min( gridrows, maxrows );\n\n\t\t\tconst compiledAttributes = Object.assign( {}, attributes, {\n\t\t\t\tgridcolumns: attributes.flipcolsrows ? gridrows : gridcolumns,\n\t\t\t\tgridrows: attributes.flipcolsrows ? gridcolumns : gridrows,\n\t\t\t} );\n\n\t\t\t$grid.css( getGridStyle( compiledAttributes ) );\n\n\t\t\tif ( below( 'lap' ) || attributes.headerposition === 0 ) {\n\t\t\t\t$title.clone().addClass( 'js-collection-element-clone' ).insertBefore( $cards );\n\t\t\t\t$subtitle.clone().addClass( 'js-collection-element-clone' ).insertBefore( $cards );\n\t\t\t}\n\n\t\t\tfor ( let i = 0; i < areaColumns.length; i++ ) {\n\t\t\t\tconst areaColumn = areaColumns[i];\n\t\t\t\tconst { areas, row, col, width, height } = areaColumn;\n\n\t\t\t\tconst $column = $( '<div class=\"novablocks-grid__column\">' );\n\t\t\t\t$column.css( 'grid-area', `${ row } / ${ col } / span ${ height } / span ${ width }` );\n\t\t\t\t$column.attr( 'data-area', `${ row } / ${ col } / span ${ height } / span ${ width }` );\n\n\t\t\t\tfor ( let j = 0; j < areas.length; j++ ) {\n\t\t\t\t\tconst area = areas[j];\n\t\t\t\t\tconst blockWidthRatio = Math.min( 1, blockWidth / defaultBlockWidth );\n\t\t\t\t\tconst areaClassName = getAreaClassname( area, attributes, blockWidthRatio );\n\n\t\t\t\t\taddedCards += area.postsCount;\n\n\t\t\t\t\tconst $area = $( `<div class=\"${ areaClassName }\">` );\n\n\t\t\t\t\tArray.from( Array( area.postsCount ).keys() ).map( i => {\n\t\t\t\t\t\tconst $gridItem = $( '<div class=\"novablocks-grid__item\">' );\n\t\t\t\t\t\tconst $card = $posts.eq( addedCards - area.postsCount + i );\n\t\t\t\t\t\tconst landscape = isLandscape( area, attributes );\n\n\t\t\t\t\t\t$card.toggleClass( 'novablocks-card--landscape', !! landscape );\n\t\t\t\t\t\t$card.toggleClass( 'novablocks-card--portrait', ! landscape );\n\n\t\t\t\t\t\t$card.appendTo( $gridItem );\n\n\t\t\t\t\t\tif ( ! below( 'lap' ) && attributes.headerposition === addedCards - area.postsCount + i + 1 ) {\n\t\t\t\t\t\t\tconst $header = $( '<div class=\"novablocks-grid__item js-collection-element-clone\">' );\n\t\t\t\t\t\t\t$title.clone().appendTo( $header );\n\t\t\t\t\t\t\t$subtitle.clone().appendTo( $header );\n\t\t\t\t\t\t\t$header.appendTo( $area );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$gridItem.appendTo( $area );\n\t\t\t\t\t} );\n\n\t\t\t\t\t$area.appendTo( $column );\n\t\t\t\t}\n\n\t\t\t\t$column.appendTo( $grid );\n\t\t\t}\n\t\t}\n\n\t\tfunction recreateLayout() {\n\t\t\t$grid.contents().replaceWith( $posts );\n\n\t\t\t$grid.css( {\n\t\t\t\tdisplay: '',\n\t\t\t\tgridTemplateColumns: '',\n\t\t\t\tgridTemplateRowss: '',\n\t\t\t} );\n\n\t\t\t$posts.removeClass( 'novablocks-card--portrait' );\n\t\t\t$posts.removeClass( 'novablocks-card--landscape' );\n\n\t\t\tcreateLayout();\n\t\t}\n\n\t} );\n\n\tfunction getAreaClassname( area, attributes, widthRatioMultiplier = 1 ) {\n\t\tconst { width, height } = area;\n\t\tconst { gridcolumns, gridrows } = getGridColumnsAndRows( attributes );\n\n\t\treturn classnames([\n\t\t\tgetAreaBaseClassname( area ),\n\t\t\tgetAreaClassnameByWidthRatio( widthRatioMultiplier * width / gridcolumns ),\n\t\t\tgetAreaClassnameByHeightRatio( height / gridrows ),\n\t\t\tgetAreaClassnameByAspectRatio( area, attributes )\n\t\t]);\n\n\t}\n\n\tfunction removeSmallestColumn( areaColumns ) {\n\n\t\tlet data = areaColumns.map( ( area, index ) => {\n\t\t\treturn {\n\t\t\t\tarea,\n\t\t\t\tindex,\n\t\t\t}\n\t\t} );\n\n\t\tdata.sort( ( obj1, obj2 ) => {\n\t\t\treturn obj1.area.width - obj2.area.width;\n\t\t} );\n\n\t\tlet indexToRemove = data[0].index;\n\n\t\tif ( data[0].area.nth === 1 ) {\n\t\t\tindexToRemove = data[data.length].index;\n\t\t}\n\n\t\tareaColumns.splice( indexToRemove, 1 );\n\t}\n\n\tfunction normalizeColumns( areaColumns, attributes ) {\n\t\tmoveColumnsToLeft( areaColumns );\n\t\tgrowColumnsToRight( areaColumns, attributes );\n\t\tmoveColumnsToTop( areaColumns );\n\n\t\tareaColumns.forEach( areaColumn => {\n\t\t\tareaColumn.areas.forEach( area => {\n\t\t\t\tarea.col = areaColumn.col;\n\t\t\t\tarea.width = areaColumn.width;\n\t\t\t} )\n\t\t} )\n\t}\n\n\tfunction moveColumnsToLeft( areaColumns ) {\n\n\t\tareaColumns.forEach( areaColumn => {\n\t\t\tlet spaceLeft = 0;\n\t\t\tlet movingLeft = true;\n\n\t\t\twhile ( movingLeft ) {\n\n\t\t\t\tconst overlapLeft = areaColumns.filter( compareColumn => compareColumn !== areaColumn ).some( compareColumn => {\n\t\t\t\t\treturn ! ( areaColumn.col + areaColumn.width - 1 < compareColumn.col ||\n\t\t\t\t\t           areaColumn.row + areaColumn.height - 1 < compareColumn.row ||\n\t\t\t\t\t           areaColumn.row > compareColumn.row + compareColumn.height - 1 ||\n\t\t\t\t\t           areaColumn.col - ( spaceLeft + 1 ) > compareColumn.col + compareColumn.width - 1 );\n\t\t\t\t} );\n\n\t\t\t\tif ( overlapLeft || areaColumn.col - spaceLeft <= 1 ) {\n\t\t\t\t\tmovingLeft = false;\n\t\t\t\t} else {\n\t\t\t\t\tspaceLeft++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tareaColumn.col = areaColumn.col - spaceLeft;\n\t\t} );\n\t}\n\n\tfunction growColumnsToRight( areaColumns, attributes ) {\n\t\tconst { gridcolumns } = attributes;\n\n\t\tareaColumns.forEach( areaColumn => {\n\t\t\tlet spaceRight = 0;\n\t\t\tlet growingRight = true;\n\n\t\t\twhile ( growingRight ) {\n\n\t\t\t\tconst overlapRight = areaColumns.filter( compareColumn => compareColumn !== areaColumn ).some( compareColumn => {\n\t\t\t\t\treturn ! ( areaColumn.col + areaColumn.width + spaceRight < compareColumn.col ||\n\t\t\t\t\t           areaColumn.row + areaColumn.height - 1 < compareColumn.row ||\n\t\t\t\t\t           areaColumn.row > compareColumn.row + compareColumn.height - 1 ||\n\t\t\t\t\t           areaColumn.col > compareColumn.col + compareColumn.width - 1 );\n\t\t\t\t} );\n\n\t\t\t\tif ( overlapRight || areaColumn.col + areaColumn.width + spaceRight - 1 >= gridcolumns ) {\n\t\t\t\t\tgrowingRight = false;\n\t\t\t\t} else {\n\t\t\t\t\tspaceRight++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tareaColumn.width = areaColumn.width + spaceRight;\n\t\t} );\n\t}\n\n\tfunction moveColumnsToTop( areaColumns ) {\n\n\t\tareaColumns.forEach( areaColumn => {\n\t\t\tlet spaceTop = 0;\n\t\t\tlet movingTop = true;\n\n\t\t\twhile ( movingTop ) {\n\n\t\t\t\tconst overlapTop = areaColumns.filter( compareColumn => compareColumn !== areaColumn ).some( compareColumn => {\n\t\t\t\t\treturn ! ( areaColumn.col + areaColumn.width - 1 < compareColumn.col ||\n\t\t\t\t\t           areaColumn.row + areaColumn.height - 1 < compareColumn.row ||\n\t\t\t\t\t           areaColumn.row - ( spaceTop + 1 ) > compareColumn.row + compareColumn.height - 1 ||\n\t\t\t\t\t           areaColumn.col > compareColumn.col + compareColumn.width - 1 );\n\t\t\t\t} );\n\n\t\t\t\tif ( overlapTop || areaColumn.row - spaceTop <= 1 ) {\n\t\t\t\t\tmovingTop = false;\n\t\t\t\t} else {\n\t\t\t\t\tspaceTop++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tareaColumn.row = areaColumn.row - spaceTop;\n\t\t} );\n\t}\n\n})(jQuery, window);\n","import { transposeMatrix } from './utils';\n\n// This is the main workhorse containing the logic of our layout \"engine\".\n// Given a state, it will return a list of posts with details to handle their layout.\nexport const applyLayoutEngine = state => {\n\n\tconst debug = false;\n\n\t// Before we can get to generating the \"grid areas\" for each post (meaning start col and row plus end col and ro),\n\t// we need to do a couple of preliminary calculations.\n\t// To hold the data, we will work with matrices, uni or bidimensional, representing the actual columns and rows.\n\t// This way we gain an easier understanding of what is going on at each step of the logic.\n\t// In each matrix we will ignore index 0 since it is easier to start from 1,\n\t// the same way CSS grid columns and rows behave.\n\n\t// The order of these operation is important!\n\n\tdebug ? console.log( \"\\nGenerating a new layout...\\n\\n\"): false;\n\n\t// The \"null\" character:\n\tconst emptyChar = \"X\";\n\n\t// These are the matrices we are going to calculate:\n\t// The nth matrix: a bidimensional matrix the same size as the grid, holding in each cell what nth post should that cell belong to.\n\t// From this matrix we can extrapolate many details since the same nth value will be used to fill all the cells belonging to a post.\n\t// So we know the position and dimensions.\n\tconst nthMatrix = initBidimensionalMatrix([], state.gridcolumns, state.gridrows, emptyChar);\n\t// The image weight matrix\n\tconst imageWeightMatrix = initBidimensionalMatrix([], state.gridcolumns, state.gridrows, emptyChar);\n\t// The meta-details matrix\n\tconst metaDetailsMatrix = initBidimensionalMatrix([], state.gridcolumns, state.gridrows, emptyChar);\n\n\t// Helper matrices.\n\n\t// The columns width matrix\n\tconst widthMatrix = initUnidimensionalMatrix([], state.gridcolumns, emptyChar);\n\t// The vertical fragment size matrix\n\tconst verticalFragmentSizeMatrix = initUnidimensionalMatrix([], state.gridcolumns, emptyChar);\n\n\tlet i,j;\n\n\t// Lets start PRELIMINARY CALCULATIONS!\n\n\t/*\n\t1. Calculate the columns width matrix.\n\t   We will take into account the feature position, feature size and fragmentation value.\n\t   The fragmentation value is interpreted in it's bit format, where 1 means a \"cut\".\n\t   The fragmentation value represents the fragmentation of the remaining gridcolumns after the feature size was deducted.\n\t */\n\n\tlet widthIdx = 1;\n\t// First, mark the feature.\n\tfor (i=state.featureposition; i < state.featureposition + state.featuresize; i++) {\n\t\twidthMatrix[i] = widthIdx;\n\t}\n\n\t// Next, go from left to right in the columns width matrix, and fill each columns with the same unique number,\n\t// Taking into account the fragmentation.\n\t// And remember the positions we are int the virtual matrix without the feature.\n\tlet frgIdx = 0;\n\twidthIdx++;\n\tfor (i=1; i <= state.gridcolumns; i++) {\n\t\tif (widthMatrix[i] === emptyChar) {\n\t\t\tfrgIdx++;\n\t\t\t// If the previous position has a different number than the current one, it is clear we should increment and write.\n\t\t\tif (widthMatrix[i-1] !== widthIdx) {\n\t\t\t\twidthIdx++;\n\t\t\t} else {\n\t\t\t\t// If the previous position has the same value as the current one, we need to determine\n\t\t\t\t// if the fragmentation bit pattern imposes a \"cut\".\n\t\t\t\tconst cutMarker = 1<<(state.gridcolumns-state.featuresize-frgIdx);\n\t\t\t\t// If there is a 1 at this position, make a cut aka increase the number.\n\t\t\t\tif ((cutMarker & state.fragmentation) === cutMarker) {\n\t\t\t\t\twidthIdx++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twidthMatrix[i] = widthIdx;\n\t\t}\n\t}\n\n\tdebug ? console.log( \"The width matrix: \".padEnd(45,' ') + widthMatrix) : false;\n\n\t/*\n\t2. Calculate the image weight matrix.\n\t   We will spread the image weight range left-to-right. Each column will consume the range according to its width.\n\t   Even it is a bidimensional matrix, for now we will only generate one row and copy it.\n   */\n\tfor (i=1; i <= state.gridcolumns; i++) {\n\t\t// Determine the other end of the current column.\n\t\tlet end=i;\n\t\twhile (widthMatrix[end+1] === widthMatrix[i]) {\n\t\t\tend++;\n\t\t}\n\n\t\t// Now calculate.\n\t\tif (i === 1) {\n\t\t\timageWeightMatrix[1][i] = state.imageweightleft;\n\t\t} else if (end === state.gridcolumns) {\n\t\t\timageWeightMatrix[1][i] = state.imageweightright;\n\t\t} else {\n\t\t\timageWeightMatrix[1][i] = Math.round(state.imageweightleft - ((state.imageweightleft - state.imageweightright) * (i + end - 1) / (2 * state.gridcolumns)));\n\t\t}\n\n\t\t// Fill the entire column with the same meta-details value.\n\t\tfor (j=i; j <= end; j++) {\n\t\t\timageWeightMatrix[1][j] = imageWeightMatrix[1][i];\n\t\t}\n\t\ti=end;\n\t}\n\t// Copy the first row to all of the rest.\n\tfor (i=2; i <= state.gridrows; i++) {\n\t\timageWeightMatrix[i] = imageWeightMatrix[1].slice(); // .slice() creates a copy of the array, not reference.\n\t}\n\n\tdebug ? console.log( \"The image weight matrix: \".padEnd(45,' ') + imageWeightMatrix[1]) : false;\n\n\t/*\n\t3. Calculate the meta-details matrix.\n\t   We will spread the meta-details range left-to-right. Each column will consume the range according to its width.\n\t   Even it is a bidimensional matrix, for now we will only generate one row and copy it.\n\t */\n\tfor (i=1; i <= state.gridcolumns; i++) {\n\t\t// Determine the other end of the current column.\n\t\tlet end=i;\n\t\twhile (widthMatrix[end+1] === widthMatrix[i]) {\n\t\t\tend++;\n\t\t}\n\n\t\t// Now calculate.\n\t\tif (i === 1) {\n\t\t\tmetaDetailsMatrix[1][i] = state.metadetailsleft;\n\t\t} else if (end === state.gridcolumns) {\n\t\t\tmetaDetailsMatrix[1][i] = state.metadetailsright;\n\t\t} else {\n\t\t\tmetaDetailsMatrix[1][i] = state.metadetailsleft - ((state.metadetailsleft - state.metadetailsright) * (i + end - 1) / (2 * state.gridcolumns));\n\n\t\t\t// If we are instructed to balance MD with IW, we will multiply the MD value with the \"distance\" of the IW value from the \"center\" of the IW range.\n\t\t\tif (state.balancemdandiw && 0 !== state.imageweightleft - state.imageweightright) {\n\t\t\t\tmetaDetailsMatrix[1][i] = metaDetailsMatrix[1][i] * (Math.abs(state.imageweightleft - state.imageweightright) / 2 / imageWeightMatrix[1][i]);\n\t\t\t}\n\n\t\t\tmetaDetailsMatrix[1][i] = Math.round( metaDetailsMatrix[1][i] );\n\t\t}\n\n\t\t// Fill the entire column with the same meta-details value.\n\t\tfor (j=i; j <= end; j++) {\n\t\t\tmetaDetailsMatrix[1][j] = metaDetailsMatrix[1][i];\n\t\t}\n\t\ti=end;\n\t}\n\t// Copy the first row to all of the rest.\n\tfor (i=2; i <= state.gridrows; i++) {\n\t\tmetaDetailsMatrix[i] = metaDetailsMatrix[1].slice(); // .slice() creates a copy of the array, not reference.\n\t}\n\n\tdebug ? console.log( \"The meta-details matrix: \".padEnd(45,' ') + metaDetailsMatrix[1]) : false;\n\n\t/*\n\t4. Handle the boost feature emphasis.\n\t   We will assign the maximum meta-details and image weight value to the feature, and assign its current value to the column holding the maximum values.\n\t*/\n\tif (state.boostfeature && state.featuresize > 0) {\n\t\t// Find column with maximum meta-details value, if the feature isn't already at the max.\n\t\tlet maxMetaDetailsPos = 1,\n\t\t\tmaxImageWeightPos = 1;\n\t\tfor (i = 1; i <= state.gridcolumns; i++) {\n\t\t\tif (metaDetailsMatrix[1][i] > metaDetailsMatrix[1][maxMetaDetailsPos]) {\n\t\t\t\tmaxMetaDetailsPos = i;\n\t\t\t}\n\n\t\t\tif (imageWeightMatrix[1][i] > imageWeightMatrix[1][maxImageWeightPos]) {\n\t\t\t\tmaxImageWeightPos = i;\n\t\t\t}\n\t\t}\n\n\t\tif (maxMetaDetailsPos !== state.featureposition) {\n\t\t\t// We have something to switch.\n\t\t\tlet featureValue = metaDetailsMatrix[1][state.featureposition];\n\t\t\tlet maxValue = metaDetailsMatrix[1][maxMetaDetailsPos];\n\n\t\t\t// Go and fill each column with the switched values.\n\t\t\ti = maxMetaDetailsPos;\n\t\t\twhile (widthMatrix[i] === widthMatrix[maxMetaDetailsPos]) {\n\t\t\t\tmetaDetailsMatrix[1][i] = featureValue;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\ti = state.featureposition;\n\t\t\twhile (widthMatrix[i] === widthMatrix[state.featureposition]) {\n\t\t\t\tmetaDetailsMatrix[1][i] = maxValue;\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t// Copy the first row to all of the rest.\n\t\t\tfor (i=2; i <= state.gridrows; i++) {\n\t\t\t\tmetaDetailsMatrix[i] = metaDetailsMatrix[1].slice(); // .slice() creates a copy of the array, not reference.\n\t\t\t}\n\n\t\t\tdebug ? console.log( \"The boosted feature meta-details matrix: \".padEnd(45,' ') + metaDetailsMatrix[1]) : false;\n\t\t}\n\n\t\tif (maxImageWeightPos !== state.featureposition) {\n\t\t\t// We have something to switch.\n\t\t\tlet featureValue = imageWeightMatrix[1][state.featureposition];\n\t\t\tlet maxValue = imageWeightMatrix[1][maxImageWeightPos];\n\n\t\t\t// Go and fill each column with the switched values.\n\t\t\ti = maxImageWeightPos;\n\t\t\twhile (widthMatrix[i] === widthMatrix[maxImageWeightPos]) {\n\t\t\t\timageWeightMatrix[1][i] = featureValue;\n\t\t\t\ti++;\n\t\t\t}\n\t\t\ti = state.featureposition;\n\t\t\twhile (widthMatrix[i] === widthMatrix[state.featureposition]) {\n\t\t\t\timageWeightMatrix[1][i] = maxValue;\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t// Copy the first row to all of the rest.\n\t\t\tfor (i=2; i <= state.gridrows; i++) {\n\t\t\t\timageWeightMatrix[i] = imageWeightMatrix[1].slice(); // .slice() creates a copy of the array, not reference.\n\t\t\t}\n\n\t\t\tdebug ? console.log( \"The boosted feature image weight matrix: \".padEnd(45,' ') + imageWeightMatrix[1]) : false;\n\t\t}\n\t}\n\n\t/*\n\t5. Determine the vertical fragment size matrix.\n\t   The fragment size will range in the number of grid rows and 1.\n\t*/\n\t// First determine the max meta-details and image weight value.\n\tlet maxMetaDetailsValue = metaDetailsMatrix[1][1],\n\t\tmaxImageWeightValue = imageWeightMatrix[1][1];\n\tfor (i = 1; i <= state.gridcolumns; i++) {\n\t\tif (metaDetailsMatrix[1][i] > maxMetaDetailsValue) {\n\t\t\tmaxMetaDetailsValue = metaDetailsMatrix[1][i];\n\t\t}\n\n\t\tif (imageWeightMatrix[1][i] > maxImageWeightValue) {\n\t\t\tmaxImageWeightValue = imageWeightMatrix[1][i];\n\t\t}\n\t}\n\n\t// For the purpose of these calculations, maxMetaDetailsValue and maxImageWeightValue can't be zero.\n\tif (maxImageWeightValue < 1) {\n\t\tmaxImageWeightValue = 1;\n\t}\n\tif (maxMetaDetailsValue < 1) {\n\t\tmaxMetaDetailsValue = 1;\n\t}\n\n\tfor (i=1; i <= state.gridcolumns; i++) {\n\t\t// Determine the other end of the current column.\n\t\tlet end=i;\n\t\twhile (widthMatrix[end+1] === widthMatrix[i]) {\n\t\t\tend++;\n\t\t}\n\n\t\t// Now calculate.\n\t\tverticalFragmentSizeMatrix[i] = Math.round((((metaDetailsMatrix[1][i] / maxMetaDetailsValue) + (imageWeightMatrix[1][i] / maxImageWeightValue)) / 2) * state.gridrows);\n\t\t// The vertical fragment size can't be more than 3 times the column width (a really tall post).\n\t\tif (verticalFragmentSizeMatrix[i] > (end - i + 1) * 3) {\n\t\t\tverticalFragmentSizeMatrix[i] = (end - i + 1) * 3;\n\t\t}\n\t\t// Also the vertical fragment size can't be less than 1.\n\t\tif (verticalFragmentSizeMatrix[i] < 1) {\n\t\t\tverticalFragmentSizeMatrix[i] = 1;\n\t\t}\n\n\t\t// If the sub feature option is active, and we have a single column for the feature, reduce the vertical fragmentation with 25%.\n\t\tif (state.subfeature && i === state.featureposition && state.featuresize > 0 && verticalFragmentSizeMatrix[i] === state.gridrows) {\n\t\t\tverticalFragmentSizeMatrix[i] = Math.floor(verticalFragmentSizeMatrix[i] * 0.75);\n\t\t}\n\n\t\t// Safety measures.\n\t\tif (verticalFragmentSizeMatrix[i] < 1) {\n\t\t\tverticalFragmentSizeMatrix[i] = 1;\n\t\t} else if (verticalFragmentSizeMatrix[i] > state.gridrows) {\n\t\t\tverticalFragmentSizeMatrix[i] = state.gridrows;\n\t\t}\n\n\t\t// Fill the entire column with the same fragment size.\n\t\tfor (j = i; j <= end; j++) {\n\t\t\tverticalFragmentSizeMatrix[j] = verticalFragmentSizeMatrix[i];\n\t\t}\n\t\ti=end;\n\t}\n\n\tdebug ? console.log( \"The vertical fragment size matrix: \".padEnd(45,' ') + verticalFragmentSizeMatrix) : false;\n\n\t/*\n\t6. Determine the nth bidimensional matrix.\n\t   Each grid cell will be filled with the nth post that cell belongs to. From this matrix we can determine the post grid coordinates,\n\t   its aspect ratio, area, etc.\n\t*/\n\n\t// We start with the first post in the list.\n\tlet currentNth = 1;\n\n\t// Start with the feature column.\n\tif (state.featuresize > 0) {\n\t\ti = 1;\n\t\twhile (i <= verticalFragmentSizeMatrix[state.featureposition]) {\n\t\t\tj = state.featureposition;\n\t\t\tdo {\n\t\t\t\tnthMatrix[i][j] = currentNth;\n\t\t\t\tj++;\n\t\t\t} while (widthMatrix[state.featureposition] === widthMatrix[j])\n\n\t\t\ti++;\n\t\t}\n\n\t\tcurrentNth++;\n\n\t\tif (i <= state.gridrows) {\n\t\t\t// We have room under the feature for a secondary feature post.\n\t\t\t// We will reduce the meta-details and image weight by 33% that of the main feature post.\n\t\t\twhile (i <= state.gridrows) {\n\t\t\t\tj = state.featureposition;\n\t\t\t\tdo {\n\t\t\t\t\tnthMatrix[i][j] = currentNth;\n\n\t\t\t\t\t// Adjust the meta-details and image weight.\n\t\t\t\t\tmetaDetailsMatrix[i][j] = Math.round(metaDetailsMatrix[i][j] * 0.66);\n\t\t\t\t\timageWeightMatrix[i][j] = Math.round(imageWeightMatrix[i][j] * 0.66);\n\n\t\t\t\t\tj++;\n\t\t\t\t} while (widthMatrix[state.featureposition] === widthMatrix[j])\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\tcurrentNth++;\n\t\t}\n\t}\n\n\t// Now start from the left top corner and go through each column, left to right.\n\tlet currentColumnStartCol = 1;\n\tlet currentPostStartRow;\n\twhile (currentColumnStartCol <= state.gridcolumns) {\n\t\tif (nthMatrix[1][currentColumnStartCol] !== emptyChar) {\n\t\t\tcurrentColumnStartCol++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Fill the current column with posts.\n\t\tcurrentPostStartRow = 1;\n\t\twhile (currentPostStartRow <= state.gridrows) {\n\t\t\ti = currentPostStartRow;\n\t\t\twhile (i <= currentPostStartRow + verticalFragmentSizeMatrix[currentColumnStartCol] - 1 && i <= state.gridrows) {\n\t\t\t\tj = currentColumnStartCol;\n\t\t\t\tdo {\n\t\t\t\t\tnthMatrix[i][j] = currentNth;\n\t\t\t\t\tj++;\n\t\t\t\t} while (widthMatrix[currentColumnStartCol] === widthMatrix[j])\n\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tcurrentNth++;\n\t\t\tcurrentPostStartRow = i;\n\t\t}\n\t}\n\n\tif (debug) {\n\t\tconsole.log(\"\\nThe nth matrix: \".padEnd(42, ' ') + '0 - ' + nthMatrix[0].join(' '));\n\t\tfor (i = 1; i < nthMatrix.length; i++) {\n\t\t\tconsole.log(' '.padEnd(41, ' ') + i + ' - ' + nthMatrix[i].join(' '));\n\t\t}\n\t}\n\n\t/*\n\t7. Handle the hierarchy crossing.\n\t   We will not cross into the feature post. We will only cross left to right, only \"over\" a post with a lower nth count.\n\t   We will only cross if the left post matches in height a post or more on the right.\n\t   The rate of consumption is related to the nth, area, IW and MD of the post being expanded and the post(s) being replaced.\n\t   Also, crossing at the top of the layout is more expensive than crossing at a lower row.\n\t*/\n\n\t// We start with the first post in the list.\n\tlet maxNth = currentNth;\n\tlet hierachyCrossingStrenth = state.hierarchycrossing;\n\n\tcurrentNth = 1;\n\n\twhile (hierachyCrossingStrenth > 0 && currentNth <= maxNth) {\n\t\tlet currentPostDetails = getNthPostDetails(currentNth, nthMatrix, metaDetailsMatrix, imageWeightMatrix);\n\t\tif (false === currentPostDetails) {\n\t\t\tcurrentNth++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// If the current post is all the way to the right edge, stop.\n\t\tif (currentPostDetails.endGridColumn === state.gridcolumns) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// Now identify its right-side neighbors.\n\t\tlet topNeighborPostDetails = getNthPostDetails(nthMatrix[currentPostDetails.startGridRow][currentPostDetails.endGridColumn+1], nthMatrix, metaDetailsMatrix, imageWeightMatrix);\n\t\tlet bottomNeighborPostDetails = getNthPostDetails(nthMatrix[currentPostDetails.endGridRow][currentPostDetails.endGridColumn+1], nthMatrix, metaDetailsMatrix, imageWeightMatrix);\n\t\t// If the neighbors don't match the height in rows of the current post, skip this post from crossing.\n\t\tif (topNeighborPostDetails.startGridRow !== currentPostDetails.startGridRow || bottomNeighborPostDetails.endGridRow !== currentPostDetails.endGridRow) {\n\t\t\tcurrentNth++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Calculate the score of the to-be replaced post(s).\n\t\t// Each post's score correlated to its nth value. The lower the nth value the bigger the score boost.\n\t\tlet replacedPostScore = (maxNth / topNeighborPostDetails.nth) * (topNeighborPostDetails.area + topNeighborPostDetails.imageWeight + topNeighborPostDetails.metaDetails);\n\t\tif (bottomNeighborPostDetails.nth !== topNeighborPostDetails.nth) {\n\t\t\tlet counter = 1;\n\t\t\tfor (i = topNeighborPostDetails.nth+1; i <= bottomNeighborPostDetails.nth; i++) {\n\t\t\t\tconst postDetails = getNthPostDetails(i, nthMatrix, metaDetailsMatrix, imageWeightMatrix);\n\t\t\t\tif (false === postDetails) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcounter++;\n\t\t\t\t// It is increasingly \"harder\" to replace multiple posts.\n\t\t\t\treplacedPostScore += (maxNth / postDetails.nth) * (postDetails.area + postDetails.imageWeight + postDetails.metaDetails * counter) * counter;\n\t\t\t}\n\t\t}\n\n\t\t// If the to-be replaced post(s) score is larger than the remaining hierarchy crossing strength, nothing to do.\n\t\tif (hierachyCrossingStrenth < replacedPostScore) {\n\t\t\tcurrentNth++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet currentPostScore = (maxNth / currentPostDetails.nth) * (currentPostDetails.area + currentPostDetails.imageWeight + currentPostDetails.metaDetails) * Math.pow(2*hierachyCrossingStrenth/50, 3);\n\t\t// If the current post score is bigger than the to-be replaced post(s) score, it's a go.\n\t\tif (currentPostScore > replacedPostScore) {\n\t\t\t// Expand the current post over the replaced ones.\n\t\t\tfor (i = topNeighborPostDetails.startGridRow; i <= bottomNeighborPostDetails.endGridRow; i++) {\n\t\t\t\tfor (j = topNeighborPostDetails.startGridColumn; j <= topNeighborPostDetails.endGridColumn; j++) {\n\t\t\t\t\tnthMatrix[i][j] = currentNth;\n\n\t\t\t\t\t// Also replace the image weight and meta-details.\n\t\t\t\t\timageWeightMatrix[i][j] = currentPostDetails.imageWeight;\n\t\t\t\t\tmetaDetailsMatrix[i][j] = currentPostDetails.metaDetails;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Decrease the crossing strength.\n\t\t\thierachyCrossingStrenth -= replacedPostScore;\n\n\t\t\t// We now have a gap in the post list. We need to renumber the posts after the replaced ones and adjust the maxnth.\n\t\t\t// The image weight and meta-details remain unchanged.\n\t\t\t// Work with the new maxNth.\n\t\t\tmaxNth = renumberNthMatrix(nthMatrix);\n\t\t}\n\n\t\tcurrentNth++;\n\t}\n\n\t// Transpose all matrices if flipcolssrows attribute is set to true\n\tconst finalNthMatrix = ! state.flipcolsrows ? nthMatrix : transposeMatrix( nthMatrix );\n\tconst finalMetaMatrix = ! state.flipcolsrows ? metaDetailsMatrix : transposeMatrix( metaDetailsMatrix );\n\tconst finalImageMatrix = ! state.flipcolsrows ? imageWeightMatrix : transposeMatrix( imageWeightMatrix );\n\n\t/*\n\t8. Finally, generate the posts list.\n\t*/\n\tconst areaColumns = getGroupedPostAreas( state, finalNthMatrix, finalMetaMatrix, finalImageMatrix );;\n\tmoveLargestColumnToStart( areaColumns );\n\n\treturn areaColumns;\n};\n\nconst moveLargestColumnToStart = ( areaColumns ) => {\n\tconst firstRowColumns = areaColumns.filter( column => column.row === 1 )\n\t                                   .sort( ( col1, col2 ) => col2.width - col1.width );\n\tconst largestColumnIndex = areaColumns.findIndex( column => column === firstRowColumns[0] );\n\tareaColumns.splice(0, 0, areaColumns.splice(largestColumnIndex, 1)[0]);\n\n\treturn areaColumns;\n};\n\nconst logMatrix = ( matrix ) =>{\n\tfor (let i = 0; i < matrix.length; i++) {\n\t\tconsole.log(' '.padEnd(41, ' ') + i + ' - ' + matrix[i].join(' '));\n\t}\n};\n\nfunction getGroupedPostAreas( state, nthMatrix, metaDetailsMatrix, imageWeightMatrix ) {\n\tlet areasArray = getAreasArray( nthMatrix, metaDetailsMatrix, imageWeightMatrix );\n\n\tmergeSimilarAreas( nthMatrix, metaDetailsMatrix, imageWeightMatrix, areasArray, state );\n\tareasArray = normalizeAreas( nthMatrix, areasArray );\n\tareasArray = areasArray.map( area => {\n\t\treturn {\n\t\t\tinitialPostsCount: area.postsCount,\n\t\t\t...area\n\t\t}\n\t} );\n\n\tlet columns = areasArray.map( area => {\n\t\treturn {\n\t\t\trow: area.row,\n\t\t\tcol: area.col,\n\t\t\twidth: area.width,\n\t\t\theight: area.height,\n\t\t\tareas: [ area ]\n\t\t}\n\t} );\n\n\t// loop through columns\n\tcolumns.forEach( currentColumn => {\n\t\t// loop through \"current\" column's areas\n\t\tcurrentColumn.areas.forEach( ( currentArea, i ) => {\n\t\t\t// loop again through columns except the current column\n\t\t\tcolumns.filter( column => column !== currentColumn ).forEach( compareColumn => {\n\t\t\t\t// loop through the \"compare\" column's areas\n\t\t\t\tcompareColumn.areas.forEach( ( compareArea, j ) => {\n\t\t\t\t\t// check if the areas have the same column and the same width\n\t\t\t\t\tif ( ! compareArea.merged &&\n\t\t\t\t\t     currentArea.col === compareArea.col &&\n\t\t\t\t\t     currentArea.width === compareArea.width &&\n\t\t\t\t\t     // and if the two areas are continuous\n\t\t\t\t\t     ( currentArea.row + currentArea.height === compareArea.row || currentArea.row === compareArea.row + compareArea.height ) ) {\n\t\t\t\t\t\t// if so, move the compared area to the current column's areas array and update the column height\n\t\t\t\t\t\tcompareArea.merged = true;\n\t\t\t\t\t\tcurrentColumn.areas.push( compareArea );\n\t\t\t\t\t\tcurrentColumn.height += compareArea.height;\n\t\t\t\t\t\tcompareColumn.areas.splice( j, 1 );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t} )\n\t} );\n\n\treturn columns.filter( randomColumn => randomColumn.areas.length > 0 );\n}\n\nfunction getNthValues( nthMatrix ) {\n\tlet values = [];\n\tlet value;\n\n\tfor ( let i = 1; i < nthMatrix.length - 1; i ++ ) {\n\t\tfor ( let j = 1; j < nthMatrix[i].length - 1; j ++ ) {\n\t\t\tvalue = nthMatrix[i][j];\n\t\t\tif ( values.indexOf( value ) === -1 ) {\n\t\t\t\tvalues.push( value );\n\t\t\t}\n\t\t}\n\t}\n\n\treturn values;\n}\n\nfunction normalizeAreas( nthMatrix, areasArray ) {\n\tconst values = getNthValues( nthMatrix );\n\tvalues.sort( ( a, b ) => {\n\t\treturn a - b;\n\t} );\n\n\tfor ( let i = 0; i < values.length; i ++ ) {\n\t\tif ( i + 1 !== values[i] ) {\n\t\t\treplaceNth( values[i], i + 1, nthMatrix );\n\t\t}\n\t}\n\n\treturn values.map( ( nth, index ) => {\n\t\tconst area = areasArray.find( area => area.nth === nth );\n\t\tarea.nth = index + 1;\n\t\treturn area;\n\t} );\n}\n\nfunction replaceNth( nth1, nth2, nthMatrix ) {\n\tfor ( let i = 1; i < nthMatrix.length - 1; i ++ ) {\n\t\tfor ( let j = 1; j < nthMatrix[i].length - 1; j ++ ) {\n\t\t\tif ( nthMatrix[i][j] === nth1 ) {\n\t\t\t\tnthMatrix[i][j] = nth2;\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst mergeSimilarAreas = ( nthMatrix, metaDetailsMatrix, imageWeightMatrix, areasArray, state ) => {\n\tlet currentPostDetails;\n\n\tfor ( let currentNth = 1; currentNth <= getMaxNth( nthMatrix ); currentNth++  ) {\n\t\tcurrentPostDetails = getNthPostDetails( currentNth, nthMatrix, metaDetailsMatrix, imageWeightMatrix );\n\t\tif ( currentPostDetails ) {\n\t\t\tmergeAreaNeighbours( currentPostDetails.startGridRow, currentPostDetails.startGridColumn, nthMatrix, metaDetailsMatrix, imageWeightMatrix, areasArray, state );\n\t\t}\n\t}\n};\n\nconst mergeAreaNeighbours = ( row, col, nthMatrix, metaDetailsMatrix, imageWeightMatrix, areasArray, state ) => {\n\tlet nth = nthMatrix[row][col];\n\tlet width = getAreaWidth( nth, nthMatrix );\n\tlet height = getAreaHeight( nth, nthMatrix );\n\tlet initialWidth = width;\n\tlet initialHeight = height;\n\tlet currentAreaIndex = -1;\n\n\tif ( Array.isArray( areasArray ) ) {\n\t\tcurrentAreaIndex = areasArray.findIndex( area => {\n\t\t\treturn area.nth === nthMatrix[row][col];\n\t\t} )\n\t}\n\n\t// Featured area should not be merged\n\tif ( nth === 1 ) {\n\t\treturn;\n\t}\n\n\tlet nextRow,\n\t\tnextCol,\n\t\tnextWidth,\n\t\tnextHeight,\n\t\tnextNth,\n\t\tnextNthStart,\n\t\tsearching = true,\n\t\tmergeable = false;\n\n\twhile ( searching ) {\n\t\tnextNth = nthMatrix[row + height][col];\n\t\tnextNthStart = getFirstOccurence( nextNth, nthMatrix );\n\t\tnextRow = nextNthStart.row;\n\t\tnextCol = nextNthStart.col;\n\n\t\tnextWidth = getAreaWidth( nextNth, nthMatrix );\n\t\tnextHeight = getAreaHeight( nextNth, nthMatrix );\n\n\t\tif ( width === nextWidth &&\n\t\t     col === nextCol &&\n\t\t     Math.abs( initialHeight - nextHeight ) <= 1 &&\n\t\t     Math.abs( metaDetailsMatrix[row][col] - metaDetailsMatrix[nextRow][col] ) <= 1 &&\n\t\t     Math.abs( imageWeightMatrix[row][col] - imageWeightMatrix[nextRow][col] ) <= 1 ) {\n\t\t\theight = height + nextHeight;\n\n\t\t\tmergeable = true;\n\n\t\t\tif ( currentAreaIndex > -1 ) {\n\t\t\t\tareasArray[currentAreaIndex].postsCount += 1;\n\t\t\t\tareasArray[currentAreaIndex].height = height;\n\t\t\t}\n\t\t} else {\n\t\t\tsearching = false;\n\t\t}\n\t}\n\n\tsearching = ! mergeable;\n\n\twhile ( searching && ! state.flipcolsrows ) {\n\t\tnextNth = nthMatrix[row][col + width];\n\t\tnextNthStart = getFirstOccurence( nextNth, nthMatrix );\n\t\tnextRow = nextNthStart.row;\n\t\tnextCol = nextNthStart.col;\n\n\t\tnextWidth = getAreaWidth( nextNth, nthMatrix );\n\t\tnextHeight = getAreaHeight( nextNth, nthMatrix );\n\n\t\tif ( height === nextHeight &&\n\t\t     row === nextRow &&\n\t\t     Math.abs( initialWidth - nextWidth ) <= 1 &&\n\t\t     Math.abs( metaDetailsMatrix[row][col] - metaDetailsMatrix[row][nextCol] ) <= 1 &&\n\t\t     Math.abs( imageWeightMatrix[row][col] - imageWeightMatrix[row][nextCol] ) <= 1 ) {\n\t\t\twidth = width + nextWidth;\n\n\t\t\tmergeable = true;\n\n\t\t\tif ( currentAreaIndex > -1 ) {\n\t\t\t\tareasArray[currentAreaIndex].postsCount += 1;\n\t\t\t\tareasArray[currentAreaIndex].width = width;\n\t\t\t}\n\t\t} else {\n\t\t\tsearching = false;\n\t\t}\n\t}\n\n\tfillArea( nthMatrix, row, col, width, height );\n};\n\nconst fillArea = ( nthMatrix, row, col, width, height ) => {\n\tfor (let i = row; i < row + height; i++) {\n\t\tfor (let j = col; j < col + width; j++) {\n\t\t\tnthMatrix[i][j] = nthMatrix[row][col];\n\t\t}\n\t}\n};\n\nconst getFirstOccurence = ( nth, nthMatrix ) => {\n\tfor ( let i = 0; i < nthMatrix.length; i++ ) {\n\t\tfor ( let j = 0; j < nthMatrix[i].length; j++ ) {\n\t\t\tif ( nthMatrix[i][j] === nth ) {\n\t\t\t\treturn {\n\t\t\t\t\trow: i,\n\t\t\t\t\tcol: j,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {};\n};\n\nconst getAreaWidth = ( nth, nthMatrix ) => {\n\tconst { row, col } = getFirstOccurence( nth, nthMatrix );\n\tlet width = 1;\n\n\twhile ( nth === nthMatrix[row][col + width] ) {\n\t\twidth = width + 1;\n\t}\n\n\treturn width;\n};\n\n\n\nconst getAreaHeight = ( nth, nthMatrix ) => {\n\tconst { row, col } = getFirstOccurence( nth, nthMatrix );\n\tlet height = 1;\n\n\twhile ( \"undefined\" !== typeof nthMatrix[row + height] && nth === nthMatrix[row + height][col] ) {\n\t\theight = height + 1;\n\t}\n\n\treturn height;\n};\n\nconst renumberNthMatrix = (nthMatrix) => {\n\tlet newNth = 1;\n\tlet postDetails;\n\n\tfor (let nth = 1; nth <= getMaxNth(nthMatrix); nth++) {\n\t\t// If we can't find a nth post, it means it was removed and we need to adjust.\n\t\tpostDetails = getNthPostDetails(nth, nthMatrix);\n\t\tif (false === postDetails) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (postDetails.nth > newNth) {\n\t\t\t// Change the current post's nth.\n\t\t\tfor (let i = postDetails.startGridRow; i <= postDetails.endGridRow; i++) {\n\t\t\t\tfor (let j = postDetails.startGridColumn; j <= postDetails.endGridColumn; j++) {\n\t\t\t\t\tnthMatrix[i][j] = newNth;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tnewNth++;\n\t}\n\n\t// Return the maxNth.\n\treturn newNth - 1;\n};\n\nconst getMaxNth = (nthMatrix) => {\n\tlet maxNth = 0;\n\tfor (let i = 1; i < nthMatrix.length; i++) {\n\t\tfor (let j = 1; j < nthMatrix[i].length; j++) {\n\t\t\tif (nthMatrix[i][j] > maxNth) {\n\t\t\t\tmaxNth = nthMatrix[i][j];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn maxNth;\n};\n\nconst getAreasArray = ( nthMatrix, metaDetailsMatrix, imageWeightMatrix ) => {\n\n\tlet currentPostDetails;\n\tlet areasArray = [];\n\n\tfor ( let currentNth = 1; currentNth <= getMaxNth( nthMatrix ); currentNth++  ) {\n\t\tcurrentPostDetails = getNthPostDetails( currentNth, nthMatrix, metaDetailsMatrix, imageWeightMatrix );\n\n\t\tif ( currentPostDetails ) {\n\n\t\t\tareasArray.push( {\n\t\t\t\tnth: currentPostDetails.nth,\n\t\t\t\tcol: currentPostDetails.startGridColumn,\n\t\t\t\trow: currentPostDetails.startGridRow,\n\t\t\t\twidth: currentPostDetails.endGridColumn - currentPostDetails.startGridColumn + 1,\n\t\t\t\theight: currentPostDetails.endGridRow - currentPostDetails.startGridRow + 1,\n\t\t\t\tmetaDetails: currentPostDetails.metaDetails,\n\t\t\t\timageWeight: currentPostDetails.imageWeight,\n\t\t\t\tpostsCount: 1,\n\t\t\t} )\n\t\t}\n\t}\n\n\treturn areasArray;\n};\n\nconst getNthPostDetails = (nth, nthMatrix, metaDetailsMatrix = false, imageWeightMatrix = false) => {\n\tlet postDetails = false;\n\n\t// Go through the nthMatrix and search for the currentNth value.\n\tfor (let i = 1; i < nthMatrix.length; i++) {\n\t\tfor (let j = 1; j < nthMatrix[i].length; j++) {\n\t\t\tif (nthMatrix[i][j] === nth) {\n\t\t\t\t// Found the left top corner.\n\t\t\t\tpostDetails = {\n\t\t\t\t\t'nth': nth,\n\t\t\t\t\t'startGridColumn': j,\n\t\t\t\t\t'startGridRow': i,\n\t\t\t\t\t'endGridColumn': j,\n\t\t\t\t\t'endGridRow': i,\n\t\t\t\t\t'metaDetails': metaDetailsMatrix ? metaDetailsMatrix[i][j] : false,\n\t\t\t\t\t'imageWeight': imageWeightMatrix ? imageWeightMatrix[i][j] :false,\n\t\t\t\t\t'area': 1,\n\t\t\t\t};\n\n\t\t\t\t// Find the right bottom corner.\n\t\t\t\twhile (j < nthMatrix[i].length && nthMatrix[i][j] === nthMatrix[i][j+1]) {\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tpostDetails.endGridColumn = j;\n\t\t\t\twhile (i < nthMatrix.length && nthMatrix[i][j] === nthMatrix[i+1][j]) {\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t\tpostDetails.endGridRow = i;\n\n\t\t\t\t// Calculate the area.\n\t\t\t\tpostDetails.area = (postDetails.endGridRow - postDetails.startGridRow + 1) * (postDetails.endGridColumn - postDetails.startGridColumn + 1);\n\n\t\t\t\treturn postDetails;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn postDetails;\n};\n\nconst initUnidimensionalMatrix = (matrix, length, character = \"X\") => {\n\t// The 0 index will be filled with a different character for easier logic.\n\tmatrix.push(\"/\");\n\n\t// Go to equal the length, since the 0 index will be ignored.\n\t// Fill with \"null\" entries with the provided character.\n\tfor (let i = 1; i <= length; i++) {\n\t\tmatrix.push(character);\n\t}\n\n\t// Put an extra entry for easier logic.\n\tmatrix.push(\"/\");\n\n\treturn matrix;\n};\n\nconst initBidimensionalMatrix = (matrix, width, height, nullChar) => {\n\t// Put in a guard row, at index 0.\n\tmatrix.push(initUnidimensionalMatrix([], width, \"/\"));\n\n\t// Go to equal the width, since the 0 index will be ignored.\n\tfor (let i = 0; i < height; i++) {\n\t\tmatrix.push(initUnidimensionalMatrix([], width, nullChar));\n\t}\n\t// Put in an extra guard row.\n\tmatrix.push(initUnidimensionalMatrix([], width, \"/\"));\n\n\treturn matrix;\n};\n","import classnames from \"classnames\";\n\nexport const getGridStyle = ( attributes ) => {\n\n\tconst { gridcolumns, gridrows } = getGridColumnsAndRows( attributes );\n\n\treturn {\n\t\tdisplay: 'grid',\n\t\tgridTemplateColumns: `repeat( ${ gridcolumns }, 1fr )`,\n\t\tgridTemplateRows: `repeat( ${ gridrows }, auto )`,\n\t};\n};\n\n// Sums optimal posts count value from each area\nexport const getPostsCount = ( areaColumns ) => {\n\treturn areaColumns.reduce( ( total, areaColumn ) => {\n\t\treturn total + areaColumn.areas.reduce( ( columnTotal, area ) => {\n\t\t\treturn columnTotal + area.postsCount;\n\t\t}, 0 );\n\t}, 0 );\n};\n\nexport const redistributeCardsInAreas = ( areaColumns, cardsCount, attributes ) => {\n\tlet totalSpots = getPostsCount( areaColumns );\n\tlet totalPosts = cardsCount;\n\tlet remainingPosts = totalPosts;\n\tlet totalRatio = 0;\n\n\tfor ( let i = 0; i < areaColumns.length; i++ ) {\n\t\tlet areaColumn = areaColumns[i];\n\t\tlet areaColumnSpotRatio = 0;\n\n\t\tfor ( let j = 0; j < areaColumn.areas.length; j ++ ) {\n\t\t\tlet area = areaColumn.areas[j];\n\t\t\t// we shouldn't fill the area with the featured card\n\t\t\tarea.spotRatio = getCardRatio( area, attributes );\n\t\t\tareaColumnSpotRatio += area.spotRatio;\n\t\t\ttotalRatio += area.spotRatio;\n\t\t}\n\n\t\tareaColumn.spotRatio = areaColumnSpotRatio;\n\t}\n\n\tlet extraPosts = totalPosts - totalSpots;\n\n\tif ( totalSpots === totalPosts ) {\n\t\treturn;\n\t}\n\n\tfor ( let i = 0; i < areaColumns.length; i++ ) {\n\t\tlet areaColumn = areaColumns[i];\n\t\tlet { areas } = areaColumn;\n\n\t\tfor ( let j = 0; j < areas.length; j++ ) {\n\t\t\tlet area = areas[j];\n\t\t\tlet areaExtraPosts = Math.round( extraPosts * area.spotRatio / totalRatio );\n\t\t\tarea.postsCount = Math.max( 0, area.postsCount + areaExtraPosts );\n\t\t\ttotalRatio -= area.spotRatio;\n\t\t\textraPosts -= areaExtraPosts;\n\n\t\t\tif ( remainingPosts <= 0 ) return;\n\t\t}\n\t}\n};\n\nexport const getOptimalHeaderPosition = areaColumns => {\n\tlet index = 1;\n\tlet positions = [0];\n\n\tfor ( let columnIndex = 0; columnIndex < areaColumns.length; columnIndex++ ) {\n\t\tconst areaColumn = areaColumns[columnIndex];\n\t\tconst { areas, row } = areaColumn;\n\n\t\tfor ( let areaIndex = 0; areaIndex < areas.length; areaIndex++ ) {\n\t\t\tconst area = areas[areaIndex];\n\n\t\t\tif ( row === 1 && areaIndex === 0 ) {\n\t\t\t\tpositions.push( index );\n\t\t\t}\n\n\t\t\tindex += area.postsCount;\n\t\t}\n\t}\n\n\treturn positions;\n};\n\nconst getCardRatio = ( area, attributes ) => {\n\tconst { gridcolumns } = getGridColumnsAndRows( attributes );\n\tconst { width, height, postsCount } = area;\n\tlet ratio = postsCount / height;\n\n\t// when the card is landscape and very small\n\t// we hide the content so the ratio should be bigger\n\tif ( isLandscape( area, attributes ) ) {\n\t\tratio *= 2;\n\t}\n\n\tratio *= gridcolumns / width;\n\n\treturn ratio;\n};\n\nexport const isLandscape = ( area, attributes ) => {\n\tconst { gridcolumns, gridrows } = getGridColumnsAndRows( attributes );\n\tconst { nth, width, height, initialPostsCount } = area;\n\n\tconst isLandscape = width * initialPostsCount / height > 1.33;\n\n\tif ( width / gridcolumns >= 0.5 ) {\n\t\treturn isLandscape || ( attributes.subfeature && nth === 2 );\n\t}\n\n\treturn isLandscape;\n};\n\nexport const getParametricLayoutAreaClassName = ( area, attributes ) => {\n\tconst { gridcolumns, gridrows } = getGridColumnsAndRows( attributes );\n\tconst { width, height } = area;\n\n\treturn classnames([\n\t\tgetAreaBaseClassname( area ),\n\t\tgetAreaClassnameByWidthRatio( width / gridcolumns ),\n\t\tgetAreaClassnameByHeightRatio( height / gridrows ),\n\t\tgetAreaClassnameByAspectRatio( area, attributes )\n\t]);\n};\n\nexport const getAreaBaseClassname = ( area ) => {\n\tconst { nth } = area;\n\n\treturn classnames([\n\t\t'novablocks-grid__area',\n\t\t`novablocks-grid__area--nth-${ nth }`,\n\t]);\n};\n\nexport const getAreaClassnameByAspectRatio = ( area, attributes ) => {\n\treturn classnames([\n\t\t{\n\t\t\t'novablocks-grid__area--portrait': ! isLandscape( area, attributes ),\n\t\t\t'novablocks-grid__area--landscape': isLandscape( area, attributes ),\n\t\t}\n\t]);\n};\n\nexport const getAreaClassnameByWidthRatio = ( widthRatio ) => {\n\treturn classnames([{\n\t\t'novablocks-grid__area--width-xs': widthRatio < 0.3,\n\t\t'novablocks-grid__area--width-s': 0.3 <= widthRatio && widthRatio < 0.5,\n\t\t'novablocks-grid__area--width-m': 0.5 <= widthRatio && widthRatio < 0.66,\n\t\t'novablocks-grid__area--width-l': 0.66 <= widthRatio && widthRatio < 0.80,\n\t\t'novablocks-grid__area--width-xl': 0.80 <= widthRatio && widthRatio < 0.95,\n\t\t'novablocks-grid__area--width-full': 0.95 <= widthRatio,\n\t}]);\n};\n\nexport const getAreaClassnameByHeightRatio = ( heightRatio ) => {\n\treturn classnames([{\n\t\t'novablocks-grid__area--height-xs': heightRatio < 0.34,\n\t\t'novablocks-grid__area--height-s': 0.34 <= heightRatio && heightRatio < 0.5,\n\t\t'novablocks-grid__area--height-m': 0.5 <= heightRatio && heightRatio < 0.66,\n\t\t'novablocks-grid__area--height-l': 0.66 <= heightRatio && heightRatio < 0.80,\n\t\t'novablocks-grid__area--height-xl': 0.80 <= heightRatio,\n\t}])\n};\n\nexport const getGridColumnsAndRows = ( attributes ) => {\n\treturn {\n\t\tgridcolumns: ! attributes.flipcolsrows ? attributes.gridcolumns : attributes.gridrows,\n\t\tgridrows: ! attributes.flipcolsrows ? attributes.gridrows : attributes.gridcolumns,\n\t}\n};\n\nexport const transposeMatrix = ( source ) => {\n\treturn Object.keys( source[0] ).map( function( column ) {\n\t\treturn source.map( function( row ) {\n\t\t\treturn row[column];\n\t\t} );\n\t} );\n};\n","(function() { module.exports = this[\"novablocks\"][\"utils\"]; }());"],"sourceRoot":""}