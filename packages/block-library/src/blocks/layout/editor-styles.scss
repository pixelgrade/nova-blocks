$grid-selector: '.block-editor-inner-blocks > .block-editor-block-list__layout';

@import 'scss/mixins';

.block-editor-block-list__layout.is-root-container {
  @include layout-grid;
  @include layout-settings;
  @include block-limits;
  
  [data-type="novablocks/layout"] {
    
    --block-limit-left: ws;
    --block-limit-right: we;
    
    &[data-align="wide"] {
      --block-original-limit-left: ws;
      --block-original-limit-right: we;
    }
  
    &[data-align="full"] {
      --block-original-limit-left: fs;
      --block-original-limit-right: fe;
    }
  }
  
  .novablocks-layout [data-align][class][class] {
    --block-limit-left: var(--block-original-limit-left);
    --block-limit-right: var(--block-original-limit-left);
  }
  
  grid-auto-flow: row dense;
  
  .wp-block {
    max-width: 100% !important;
  }
  
  >  * {
    --block-limit-left: cs;
    --block-limit-right: ce;
    
    --block-content-start: var(--block-limit-left);
    --block-content-end: var(--block-limit-right);
    
    grid-column: var(--block-content-start) / var(--block-content-end);
    align-self: flex-start;
    
    
    // Temporary
    //@todo: Remove this
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  > [data-type="novablocks/layout"] {
    grid-column: var(--block-limit-left)/var(--block-limit-right);
  }
  
  > [data-align="full"] {
    --block-content-start: fs;
    --block-content-end: fe;
  }
  
  .block-list-appender {
    grid-column: var(--block-content-start)/var(--block-content-end);
  }
}

// Reset alignments
.novablocks-content {
  
  > #{$grid-selector} {
    
    > * {
      // Temporary
      // @todo: Remove this
      max-width: 100% !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }
  }
}
.novablocks-layout > #{$grid-selector} {
  
  @include layout-grid;
  
  > * {
    // Temporary
    // @todo: Remove this
    margin-top: 0 !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  [class*="__inner-container"]:not(.novablocks-card__layout-content) {
    padding-left: 0;
    padding-right: 0;
  }
}

// Block Grid
.novablocks-layout {
  
  &--sidebar-left {
  
    --block-content-start: cs;
    --block-content-end: var(--block-limit-right);
  
    //@todo: Find a better solution for this resets,
    //  to avoid repetition.
    
    .alignfull,
    .alignwide,
    [data-novablocks-alignment="pull-left"],
    [data-novablocks-alignment="pull-right"] {
      --block-limit-left: cs;
      --block-limit-right: ce;
    }
  
    [data-align="full"],
    [data-align="wide"] {
      --block-content-start: cs;
      --block-content-end: var(--block-limit-right) !important;
    }
    
    > #{$grid-selector} {
      
      > * {
        grid-row: 1;
      }
      
      @include layout-grid;
      
      // Sidebar
      >:first-child {
        grid-column: var(--block-limit-left)/gs;
        z-index: 2;
      }
      
      // Content
      >:last-child {
        
        grid-column: var(--all-columns);
        
        > .novablocks-content {
          
          > #{$grid-selector} {
            
            @include layout-grid;
            
            > * {
              grid-column: var(--block-content-start)/var(--block-content-end);
            }
          }
        }
      }
    }
  }
  
  &--sidebar-right {
  
    --block-content-start: var(--block-limit-left);
    --block-content-end: ce;
    
    //@todo: Find a better solution for this resets,
    //  to avoid repetition.
    
    .alignfull,
    .alignwide,
    [data-novablocks-alignment="pull-left"],
    [data-novablocks-alignment="pull-right"] {
      --block-limit-left: cs;
      --block-limit-right: ce;
    }
  
    [data-align="full"],
    [data-align="wide"] {
      --block-content-start: var(--block-limit-left) !important;
      --block-content-end: ce !important;
    }
    
    > #{$grid-selector} {
      
      > * {
        grid-row: 1;
      }
      
      @include layout-grid;
      
      // Content
      > :first-child {
        
        grid-column: var(--all-columns);
        
        > .novablocks-content {
          
          > #{$grid-selector} {
            
            @include layout-grid;
            
            > * {
              grid-column: var(--block-content-start)/var(--block-content-end);
            }
          }
        }
      }
      
      // Sidebar
      > :last-child {
        grid-column: ge/var(--block-limit-right);
      }
    }
  }
  
  &--complex {
  
    --block-content-start: cs;
    --block-content-end: ce;
  
    //@todo: Find a better solution for this resets,
    //  to avoid repetition.
  
    .alignfull,
    .alignwide,
    [data-novablocks-alignment="pull-left"],
    [data-novablocks-alignment="pull-right"] {
      --block-limit-left: cs;
      --block-limit-right: ce;
    }
  
    [data-align="full"],
    [data-align="wide"] {
      --block-content-start: cs;
      --block-content-end: ce !important;
    }
    
    > #{$grid-selector} {
      
      > * {
        grid-row: 1;
      }
      
      // Sidebar Left
      >:first-child {
        grid-column: var(--block-limit-left)/gs;
  
        // We need this z-index, to make sure that
        // we can select blocks that are inside the sidebar.
        z-index: 2;
      }
      
      // Content
      >:not(:first-child):not(:last-child) {
        
        grid-column: var(--all-columns);
        
        > .novablocks-content {
          
          > #{$grid-selector} {
            
            @include layout-grid;
            
            > * {
              grid-column: var(--block-content-start)/var(--block-content-end);
            }
          }
        }
      }
      
      // Sidebar Right
      >:last-child {
        grid-column: ge/var(--block-limit-right);
        
        // We need this z-index, to make sure that
        // we can select blocks that are inside the sidebar.
        z-index: 2;
      }
    }
  }
  
  .novablocks-content,
  &--sidebar-left,
  &--sidebar-right,
  &--complex {
   display: block !important;
  }
}

[data-type='novablocks/layout'] {
  
  //@include block-limits;
  
  grid-column: var(--all-columns) !important;
}

// Layout inside layout

[data-type='novablocks/layout'] {
  
  [data-type='novablocks/layout'] {
    
    grid-column: var(--all-columns) !important;
    
    .novablocks-layout {
      
      &--sidebar-left {
        
        > #{$grid-selector}[class][class][class] {
          
          // Properly position content
          > :last-child {
            
            grid-column:var(--all-columns);
            
            .novablocks-content {
              
              > #{$grid-selector} {
                
                
                > *,
                &:before {
                  grid-column: cs/ce;
                }
              }
            }
          }
        }
      }
      
      &--sidebar-right[class] {
        
        > #{$grid-selector} {
          
          > :first-child {
            
            grid-column: var(--all-columns);
  
            .novablocks-content {
    
              > #{$grid-selector} {
      
                > * {
                  grid-column: var(--block-content-start)/var(--block-content-end);
                }
              }
            }
          }
          
          > :last-child {
            grid-column: var(--block-content-end)/var(--block-limit-right);
          }
        }
      }
      
      > #{$grid-selector} {
        
        > :first-child {
          grid-column: var(--block-limit-left)/var(--block-content-start);
        }
        
        > :last-child {
          grid-column: var(--block-content-start)/var(--block-limit-right);
        }
      }
    }
  }
}

.novablocks-layout--sidebar-right .novablocks-layout--sidebar-left,
.novablocks-layout--sidebar-left .novablocks-layout--sidebar-right {
  --block-content-start: cs;
  --block-content-end: ce;
}

.novablocks-layout--sidebar-right .novablocks-layout--sidebar-right {
  --block-content-start: var(--block-limit-left);
  --block-content-end: ce;
}

// Show grid lines
.novablocks-sidebar,
.novablocks-content {
  > #{$grid-selector} {
    @include grid-border;
  }
}
